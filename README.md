# P2PNetæ•°æ®é›†å¤„ç†å·¥å…·

> æ›´æ–°æ—¥æœŸï¼š2025/11/21-14:43-sc-wang

æœ¬å·¥å…·åŒ…å«ä¸‰ä¸ª Python è„šæœ¬ï¼Œç”¨äºæ‰¹é‡å¤„ç† JSON æ ‡æ³¨æ–‡ä»¶ã€æå–ç›®æ ‡åæ ‡ã€ç»„ç»‡æ•°æ®é›†å¹¶ç”Ÿæˆè®­ç»ƒ/æµ‹è¯•åˆ—è¡¨æ–‡ä»¶ã€‚

---

## ğŸ“‹ ç›®å½•

- [æ–‡ä»¶è¯´æ˜](#æ–‡ä»¶è¯´æ˜)
- [ä¾èµ–è¦æ±‚](#ä¾èµ–è¦æ±‚)
- [ä½¿ç”¨æµç¨‹](#ä½¿ç”¨æµç¨‹)
- [è¯¦ç»†ä½¿ç”¨æ–¹æ³•](#è¯¦ç»†ä½¿ç”¨æ–¹æ³•)
- [ç¤ºä¾‹æ•°æ®é›†ç»“æ„](#ç¤ºä¾‹æ•°æ®é›†ç»“æ„)
- [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)

---

## ğŸ“ æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶å | åŠŸèƒ½ |
|--------|------|
| `GetPointCord.py` | æå–å•ä¸ª JSON æ–‡ä»¶ä¸­çš„ target_point åæ ‡å¹¶ç”Ÿæˆ TXT æ–‡ä»¶ |
| `Batch_Getpointcord.py` | æ‰¹é‡æå–ç›®å½•ä¸‹æ‰€æœ‰ JSON æ–‡ä»¶çš„ target_point åæ ‡ |
| `Getlist.py` | ç»„ç»‡æ•°æ®é›†ç›®å½•ç»“æ„ï¼Œå°†å›¾ç‰‡å’Œ TXT æ–‡ä»¶ç§»åŠ¨åˆ°å•ç‹¬æ–‡ä»¶å¤¹å¹¶ç”Ÿæˆ train/test åˆ—è¡¨æ–‡ä»¶ |

---

## ğŸ”§ ä¾èµ–è¦æ±‚

- Python 3.x
- å†…ç½®åº“ï¼š`os`, `sys`, `json`, `shutil`, `pathlib`
- **æ— éœ€å®‰è£…é¢å¤–ç¬¬ä¸‰æ–¹åº“**

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šæå–åæ ‡ï¼ˆé’ˆå¯¹åŸå§‹ JSON æ–‡ä»¶ï¼‰

```bash
python Batch_Getpointcord.py ./annotations/
```

ä¼šç”Ÿæˆæ¯ä¸ª JSON æ–‡ä»¶å¯¹åº”çš„ TXT åæ ‡æ–‡ä»¶ã€‚

### ç¬¬äºŒæ­¥ï¼šç»„ç»‡æ•°æ®é›†å¹¶ç”Ÿæˆåˆ—è¡¨æ–‡ä»¶

```bash
python Getlist.py ./dataset
```

è‡ªåŠ¨ç§»åŠ¨æ–‡ä»¶ã€åˆ›å»ºæ–‡ä»¶å¤¹å¹¶ç”Ÿæˆ `train.list` å’Œ `test.list`ã€‚

---

## ğŸ“– è¯¦ç»†ä½¿ç”¨æ–¹æ³•

### 1. GetPointCord.py

**åŠŸèƒ½ï¼š**
- ä»å•ä¸ª JSON æ ‡æ³¨æ–‡ä»¶ä¸­æå– `target_point` çš„åæ ‡
- å°†åæ ‡ä¿å­˜ä¸ºä¸ JSON æ–‡ä»¶åŒåçš„ `.txt` æ–‡ä»¶

**ä¸»è¦å‡½æ•°ï¼š**
- `extract_target_points(json_path)`ï¼šè¿”å› JSON æ–‡ä»¶ä¸­æ‰€æœ‰ `target_point` åæ ‡åˆ—è¡¨
- `save_to_txt(coordinates, output_path)`ï¼šå°†åæ ‡åˆ—è¡¨ä¿å­˜åˆ° TXT æ–‡ä»¶

**å‘½ä»¤è¡Œç”¨æ³•ï¼š**

```bash
python GetPointCord.py <jsonæ–‡ä»¶è·¯å¾„>
```

**ç¤ºä¾‹ï¼š**

```bash
python GetPointCord.py ./annotations/img01.json
```

**è¾“å‡ºï¼š**
- åœ¨ JSON æ–‡ä»¶åŒç›®å½•ç”Ÿæˆ `img01.txt`ï¼Œå†…å®¹ä¸ºåæ ‡åˆ—è¡¨

---

### 2. Batch_Getpointcord.py

**åŠŸèƒ½ï¼š**
- æ‰¹é‡å¤„ç†æŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰ JSON æ–‡ä»¶
- è°ƒç”¨ `GetPointCord.py` çš„å‡½æ•°æå–åæ ‡å¹¶ä¿å­˜ä¸º TXT æ–‡ä»¶

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
python Batch_Getpointcord.py <JSONæ–‡ä»¶ç›®å½•>
```

**ç¤ºä¾‹ï¼š**

```bash
python Batch_Getpointcord.py ./annotations/
```

**åŠŸèƒ½ç‰¹ç‚¹ï¼š**
- è‡ªåŠ¨æ‰«æç›®å½•ä¸‹æ‰€æœ‰ `.json` æ–‡ä»¶
- å¯¹æ¯ä¸ªæ–‡ä»¶ï¼š
  - æå– `target_point` åæ ‡
  - ä¿å­˜ä¸º TXT æ–‡ä»¶
  - è·³è¿‡æ²¡æœ‰ `target_point` çš„æ–‡ä»¶
- æ˜¾ç¤ºå¤„ç†ç»Ÿè®¡ä¿¡æ¯ï¼ˆæˆåŠŸã€è·³è¿‡ã€é”™è¯¯ï¼‰

---

### 3. Getlist.py

**åŠŸèƒ½ï¼š**
- ç»„ç»‡æ•°æ®é›†æ–‡ä»¶ç»“æ„ï¼Œå°†åŒåå›¾ç‰‡å’Œ TXT æ–‡ä»¶ç§»åŠ¨åˆ°ä»¥æ–‡ä»¶åå‘½åçš„æ–‡ä»¶å¤¹ä¸­
- è‡ªåŠ¨ç”Ÿæˆ `train.list` å’Œ `test.list` æ–‡ä»¶ï¼Œç”¨äºè®­ç»ƒæˆ–æµ‹è¯•

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
python Getlist.py <æ•°æ®é›†æ ¹ç›®å½•>
```

**ç¤ºä¾‹ï¼š**

```bash
python Getlist.py ./dataset
```

**ç›®å½•è¦æ±‚ï¼š**

```
dataset/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ img01.jpg
â”‚   â”œâ”€â”€ img01.txt
â”‚   â”œâ”€â”€ img02.jpg
â”‚   â””â”€â”€ img02.txt
â””â”€â”€ test/
    â”œâ”€â”€ img03.jpg
    â””â”€â”€ img03.txt
```

**æ‰§è¡Œåç›®å½•ç»“æ„ï¼š**

```
dataset/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ img01/
â”‚   â”‚   â”œâ”€â”€ img01.jpg
â”‚   â”‚   â””â”€â”€ img01.txt
â”‚   â””â”€â”€ img02/
â”‚       â”œâ”€â”€ img02.jpg
â”‚       â””â”€â”€ img02.txt
â”œâ”€â”€ test/
â”‚   â””â”€â”€ img03/
â”‚       â”œâ”€â”€ img03.jpg
â”‚       â””â”€â”€ img03.txt
â”œâ”€â”€ train.list
â””â”€â”€ test.list
```

**åˆ—è¡¨æ–‡ä»¶æ ¼å¼ï¼š**

`train.list` å†…å®¹ï¼š
```
train/img01/img01.jpg train/img01/img01.txt
train/img02/img02.jpg train/img02/img02.txt
```

`test.list` å†…å®¹ï¼š
```
test/img03/img03.jpg test/img03/img03.txt
```

---

## ğŸ“‚ ç¤ºä¾‹æ•°æ®é›†ç»“æ„

### åŸå§‹ç›®å½•ï¼š

```
annotations/
â”œâ”€â”€ img01.json
â”œâ”€â”€ img02.json
â””â”€â”€ img03.json
```

### ç»è¿‡ Batch_Getpointcord.py æå–åæ ‡åï¼š

```
annotations/
â”œâ”€â”€ img01.json
â”œâ”€â”€ img01.txt
â”œâ”€â”€ img02.json
â”œâ”€â”€ img02.txt
â”œâ”€â”€ img03.json
â””â”€â”€ img03.txt
```

### ç»è¿‡ Getlist.py ç»„ç»‡æ•°æ®é›†åï¼š

```
dataset/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ img01/
â”‚   â”‚   â”œâ”€â”€ img01.jpg
â”‚   â”‚   â””â”€â”€ img01.txt
â”‚   â””â”€â”€ img02/
â”‚       â”œâ”€â”€ img02.jpg
â”‚       â””â”€â”€ img02.txt
â”œâ”€â”€ test/
â”‚   â””â”€â”€ img03/
â”‚       â”œâ”€â”€ img03.jpg
â”‚       â””â”€â”€ img03.txt
â”œâ”€â”€ train.list
â””â”€â”€ test.list
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶ä½ç½®ï¼š** è¯·ç¡®ä¿ `GetPointCord.py` ä¸ `Batch_Getpointcord.py` åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œå¦åˆ™æ‰¹é‡æå–åŠŸèƒ½æ— æ³•è°ƒç”¨

2. **æ ‡æ³¨æ ¼å¼ï¼š** `Batch_Getpointcord.py` ä»…å¤„ç† JSON æ–‡ä»¶ä¸­ `label` ä¸º `target_point` çš„æ ‡æ³¨

3. **æ”¯æŒçš„å›¾ç‰‡æ ¼å¼ï¼š** `Getlist.py` æ”¯æŒçš„å›¾ç‰‡æ ¼å¼åŒ…æ‹¬ï¼š`.jpg`, `.jpeg`, `.png`, `.bmp`, `.tiff`, `.tif`

4. **è·¯å¾„æ ¼å¼ï¼š** æ‰€æœ‰åˆ—è¡¨æ–‡ä»¶è·¯å¾„å‡ä¸ºç›¸å¯¹è·¯å¾„ï¼Œä½¿ç”¨æ­£æ–œæ  `/`ï¼Œé€‚ç”¨äºè·¨å¹³å°è®­ç»ƒ

5. **æ•°æ®å¤‡ä»½ï¼š** å»ºè®®åœ¨è¿è¡Œè„šæœ¬å‰å¤‡ä»½åŸå§‹æ•°æ®ï¼Œé¿å…è¯¯æ“ä½œå¯¼è‡´æ•°æ®ä¸¢å¤±

---

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# æ‰¹é‡æå–åæ ‡
python Batch_Getpointcord.py ./annotations/

# ç»„ç»‡æ•°æ®é›†
python Getlist.py ./dataset

# å•æ–‡ä»¶æå–ï¼ˆå¯é€‰ï¼‰
python GetPointCord.py ./annotations/img01.json
```

---
### V1.0
åœ¨ x-anylabeling é‡Œï¼Œç”¨ ç‚¹æ ‡æ³¨ æ ‡å‡ºç›®æ ‡ï¼Œlabel åå­—å¿…é¡»æ˜¯ï¼štarget_point

å¯¼å‡º æ¯å¼ å›¾ä¸€ä¸ª JSON çš„æ ‡æ³¨æ–‡ä»¶ï¼ˆx-anylabeling é»˜è®¤çš„é‚£ç§ï¼‰ã€‚

ç”¨ Batch_GetPointCord.py æ‰¹é‡æŠŠ JSON é‡Œçš„ target_point æå–æˆ xxx.txt ç‚¹åæ ‡æ–‡ä»¶ã€‚

æŠŠå›¾ç‰‡å’Œå¯¹åº” txt æ”¾åˆ° dataset_root/trainã€dataset_root/test ä¸‹ã€‚

ç”¨ Getlist.py æŒ‰ P2PNet è¦æ±‚çš„ç»“æ„é‡ç»„æ–‡ä»¶å¤¹ï¼Œå¹¶ç”Ÿæˆ train.list / test.listã€‚

åœ¨ P2PNet é‡ŒæŠŠ --data_root æŒ‡åˆ° dataset_rootï¼Œå°±èƒ½ç›´æ¥è®­ç»ƒã€‚

### V1.1

